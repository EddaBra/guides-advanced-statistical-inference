<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Panel Data – Guides for Advanced Statistical Inference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./missing-data.html" rel="next">
<link href="./multi-level.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-cd7de1037569933fbb609f06423bd096.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./panel_data.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Panel Data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Guides for Advanced Statistical Inference</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Preface</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multi-level.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Multilevel Data Modelling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./panel_data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Panel Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missing-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Missing data and Statistical Modelling</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#load-libraries" id="toc-load-libraries" class="nav-link active" data-scroll-target="#load-libraries"><span class="header-section-number">3.1</span> Load libraries</a></li>
  <li><a href="#properties" id="toc-properties" class="nav-link" data-scroll-target="#properties"><span class="header-section-number">3.2</span> Properties</a></li>
  <li><a href="#advantages-disadvantages-of-panel-data" id="toc-advantages-disadvantages-of-panel-data" class="nav-link" data-scroll-target="#advantages-disadvantages-of-panel-data"><span class="header-section-number">3.3</span> Advantages &amp; Disadvantages of Panel data</a></li>
  <li><a href="#selectivity-and-attrition" id="toc-selectivity-and-attrition" class="nav-link" data-scroll-target="#selectivity-and-attrition"><span class="header-section-number">3.4</span> Selectivity and Attrition</a></li>
  <li><a href="#balancedness" id="toc-balancedness" class="nav-link" data-scroll-target="#balancedness"><span class="header-section-number">3.5</span> Balancedness</a></li>
  <li><a href="#peculairities" id="toc-peculairities" class="nav-link" data-scroll-target="#peculairities"><span class="header-section-number">3.6</span> Peculairities</a></li>
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise"><span class="header-section-number">3.7</span> Exercise</a>
  <ul class="collapse">
  <li><a href="#look-into-the-data-2" id="toc-look-into-the-data-2" class="nav-link" data-scroll-target="#look-into-the-data-2"><span class="header-section-number">3.7.1</span> Look into the Data 2:</a></li>
  </ul></li>
  <li><a href="#linear-panel-models" id="toc-linear-panel-models" class="nav-link" data-scroll-target="#linear-panel-models"><span class="header-section-number">3.8</span> Linear Panel Models</a>
  <ul class="collapse">
  <li><a href="#notation-and-assumptions" id="toc-notation-and-assumptions" class="nav-link" data-scroll-target="#notation-and-assumptions"><span class="header-section-number">3.8.1</span> Notation and Assumptions</a></li>
  <li><a href="#basic-framework-for-panel-data" id="toc-basic-framework-for-panel-data" class="nav-link" data-scroll-target="#basic-framework-for-panel-data"><span class="header-section-number">3.8.2</span> Basic Framework for Panel Data</a></li>
  </ul></li>
  <li><a href="#pooled-regression" id="toc-pooled-regression" class="nav-link" data-scroll-target="#pooled-regression"><span class="header-section-number">3.9</span> Pooled Regression</a>
  <ul class="collapse">
  <li><a href="#specifing-the-estimation-model" id="toc-specifing-the-estimation-model" class="nav-link" data-scroll-target="#specifing-the-estimation-model"><span class="header-section-number">3.9.1</span> Specifing the estimation model</a></li>
  <li><a href="#robust-estimation-using-group-means" id="toc-robust-estimation-using-group-means" class="nav-link" data-scroll-target="#robust-estimation-using-group-means"><span class="header-section-number">3.9.2</span> Robust Estimation using Group Means</a></li>
  <li><a href="#example-data" id="toc-example-data" class="nav-link" data-scroll-target="#example-data"><span class="header-section-number">3.9.3</span> Example Data</a></li>
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1"><span class="header-section-number">3.9.4</span> Exercise</a></li>
  </ul></li>
  <li><a href="#fixed-effects-model" id="toc-fixed-effects-model" class="nav-link" data-scroll-target="#fixed-effects-model"><span class="header-section-number">3.10</span> Fixed Effects Model</a>
  <ul class="collapse">
  <li><a href="#least-suqares-dummy-variable-model-lsdv" id="toc-least-suqares-dummy-variable-model-lsdv" class="nav-link" data-scroll-target="#least-suqares-dummy-variable-model-lsdv"><span class="header-section-number">3.10.1</span> Least suqares dummy variable model (LSDV)</a></li>
  <li><a href="#partioned-regression" id="toc-partioned-regression" class="nav-link" data-scroll-target="#partioned-regression"><span class="header-section-number">3.10.2</span> Partioned Regression</a></li>
  <li><a href="#consistency-if-partitioned-regression-estimator" id="toc-consistency-if-partitioned-regression-estimator" class="nav-link" data-scroll-target="#consistency-if-partitioned-regression-estimator"><span class="header-section-number">3.10.3</span> Consistency if partitioned regression estimator</a></li>
  <li><a href="#testing-with-the-f-test" id="toc-testing-with-the-f-test" class="nav-link" data-scroll-target="#testing-with-the-f-test"><span class="header-section-number">3.10.4</span> Testing with the F-Test</a></li>
  <li><a href="#exercise-2" id="toc-exercise-2" class="nav-link" data-scroll-target="#exercise-2"><span class="header-section-number">3.10.5</span> Exercise</a></li>
  </ul></li>
  <li><a href="#random-effects-model" id="toc-random-effects-model" class="nav-link" data-scroll-target="#random-effects-model"><span class="header-section-number">3.11</span> Random Effects Model</a>
  <ul class="collapse">
  <li><a href="#ideas" id="toc-ideas" class="nav-link" data-scroll-target="#ideas"><span class="header-section-number">3.11.1</span> Ideas</a></li>
  <li><a href="#model-specification" id="toc-model-specification" class="nav-link" data-scroll-target="#model-specification"><span class="header-section-number">3.11.2</span> Model specification</a></li>
  <li><a href="#least-squares-estimation" id="toc-least-squares-estimation" class="nav-link" data-scroll-target="#least-squares-estimation"><span class="header-section-number">3.11.3</span> Least Squares Estimation</a></li>
  <li><a href="#generalized-least-squares" id="toc-generalized-least-squares" class="nav-link" data-scroll-target="#generalized-least-squares"><span class="header-section-number">3.11.4</span> Generalized Least Squares</a></li>
  <li><a href="#exercise-3" id="toc-exercise-3" class="nav-link" data-scroll-target="#exercise-3"><span class="header-section-number">3.11.5</span> Exercise</a></li>
  <li><a href="#testing-for-random-effects-hausmans-specification-test" id="toc-testing-for-random-effects-hausmans-specification-test" class="nav-link" data-scroll-target="#testing-for-random-effects-hausmans-specification-test"><span class="header-section-number">3.11.6</span> Testing for Random Effects: Hausman’s Specification Test</a></li>
  <li><a href="#improving-random-effects-model" id="toc-improving-random-effects-model" class="nav-link" data-scroll-target="#improving-random-effects-model"><span class="header-section-number">3.11.7</span> Improving Random Effects Model</a></li>
  <li><a href="#mundlaks-approach" id="toc-mundlaks-approach" class="nav-link" data-scroll-target="#mundlaks-approach"><span class="header-section-number">3.11.8</span> Mundlak’s Approach</a></li>
  </ul></li>
  <li><a href="#which-model-to-take" id="toc-which-model-to-take" class="nav-link" data-scroll-target="#which-model-to-take"><span class="header-section-number">3.12</span> Which model to take?</a>
  <ul class="collapse">
  <li><a href="#exercise-4" id="toc-exercise-4" class="nav-link" data-scroll-target="#exercise-4"><span class="header-section-number">3.12.1</span> Exercise</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Panel Data</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><em>Recommended literature:</em></p>
<p>Greene, W. H. (2000). <a href="https://elibrary.pearson.de/book/99.150005/9781292231150">Econometric Analysis</a> from 1990. 4th edition. International edition, New Jersey: Prentice Hall, 201-215.</p>
<section id="load-libraries" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="load-libraries"><span class="header-section-number">3.1</span> Load libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="do">##basic</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer) <span class="do">##compare models</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multigroup)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plm)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mitml)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="properties" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="properties"><span class="header-section-number">3.2</span> Properties</h2>
<p>Given a set of observational units <span class="math inline">\((i = 1, . . . ,N)\)</span> you have measurements on variables at multiple time points <span class="math inline">\((t = 1, . . . ,T)\)</span> Observational units can be individuals, households, firms, countries, schools, regions.</p>
<p><strong>Dimension of panel data</strong> (important is important for properties of (parameter) estimators):</p>
<ul>
<li><span class="math inline">\(N ≫ T\)</span> (Micro panel data): only few time points but a lot of N per Time</li>
<li><span class="math inline">\(N ≡ T\)</span> (Time-series-cross-section data)</li>
<li><span class="math inline">\(T ≫ N\)</span> (Macro panel data): a lot time points but less N, i.e.&nbsp;investigate economic development of countries over the time</li>
</ul>
<p><strong>In general panel data allow for:</strong></p>
<ul>
<li>modelling and thus controlling for individual specific heterogeneity</li>
<li>avoiding aggregation bias</li>
<li>identifying otherwise non-detectable effects (like intra-individual development, how certain units change over time)</li>
<li>more data
<ul>
<li>more information (more degrees of freedom are possible)</li>
<li>more variability</li>
<li>and less multicollinearity (with less data points there is often colinearity although in reality it is not and only artificial)</li>
<li>(likely) higher statistical efficiently (more secure about what is estimated)</li>
</ul></li>
<li>modeling and analysis of dynamics and you can study causality because you have a time dimension in it (x takes place first and y takes place after)</li>
</ul>
<p><strong>Three kinds of variables</strong> arise in the context of panel data</p>
<ul>
<li>variables with variation over observational units and time <span class="math inline">\((X_{it})\)</span> + socio-economic positions</li>
<li>variables with variation only over</li>
<li>observational units <span class="math inline">\((Z_i)\)</span> + time constant variables like the birthday, ethnicity = variables with variation only over time, but not over</li>
<li>observational units <span class="math inline">\((R_t)\)</span> + external shocks, mega trends like regime, politics, floods, financial crisis</li>
</ul>
</section>
<section id="advantages-disadvantages-of-panel-data" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="advantages-disadvantages-of-panel-data"><span class="header-section-number">3.3</span> Advantages &amp; Disadvantages of Panel data</h2>
<ul>
<li>are very costly</li>
<li>confront the analyst with selectivity (self-selectivity, non response, attrition)
<ul>
<li>prospective data collection is possible, you can follow certain trends and variables in the actual time. Very advantageous, because not the problem of lying or remembering. BUT: dropouts, non response → self-selectiveness</li>
</ul></li>
<li>availability of actual data</li>
<li>data collection might be difficult (coverage, collection costs, interview spacing, etc.)</li>
<li>challenges for statistical analysis and modelling</li>
</ul>
<p><strong>Examples</strong> for individual or household panel data</p>
<ul>
<li>Socio Economic Panel (SOEP, DIW Berlin), since 1984</li>
<li>National Longitudinal Survey of Youth (NLS, U.S. Bureau of Labor Statistics), cohorts born between 1980-84</li>
<li>Panel Study of Income Dynamics (PSID, University Michigan), since 1968</li>
<li>British Household Panel Survey (BHPS, ESRC &amp; University of Essex), since 1991</li>
</ul>
<p>Firm panel data</p>
<ul>
<li>Betriebspanel (IAB, N¨urnberg), since 1993</li>
<li>Grunfelds Investmentdata (N = 11 U.S. firms), since 1950</li>
</ul>
<p>Linked panel data</p>
<ul>
<li>Linked Employer-Employee-Dataset of the IAB</li>
</ul>
<p>Regional or national panel data</p>
<ul>
<li>Penn World Tables (N = 167 countries), since 1950</li>
<li>World Development Indicators Database (World Bank)</li>
<li>Global Development Finance Database (World Bank)</li>
<li>International Financial Statistics Database (IMF)</li>
</ul>
</section>
<section id="selectivity-and-attrition" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="selectivity-and-attrition"><span class="header-section-number">3.4</span> Selectivity and Attrition</h2>
<p>Quality of panel data is depending on stability of participation.</p>
<p><strong>Problem</strong>:</p>
<p>Deutsche Forschungsgemeinschaft (DFG) only gives money for gifts but not for incentives, BUT: for the response rate it is so important to compensate people with money for their time.</p>
<p>Also an <strong>ethical question</strong>:</p>
<p>How much money is appropriate. * can strenghten bias * can be understand as an insult, because people would rather do it voluntarily (<a href="example:refugees" class="uri">example:refugees</a>) * for rich people: give a donation in their name * based on experience you have to learn whom to give what * families with kids: give the kids some little gift</p>
<p><strong>Panel mortality might lead to challenges in statistical inference</strong> since it likely implies selective (systematic) drop-outs. Information from previous waves can be used to control for this selectivity. This kind of correction refers to a selection correction as provided, for example, in the statistical framework of Heckman (1979) or inverse probability weighting.</p>
<ul>
<li>Verbeek, M., Nijman, T. (1992). Testing for selectivity bias in panel data models. International Economic Review, 681-703.</li>
<li>Fitzgerald, J., Gottschalk, P., Moffitt, R. (1998): An Analysis of Sample Attrition in Panel Data,</li>
<li>The Journal of Human Resources Sabine Zinn Hausman, J., Wise, D. (1979): Attrition ABQiaMs in Experimental and Pane8 l/ 5D6 ata, Econometrica</li>
</ul>
<p>Example: Family Survey of Deutsches Jugendinstitut In the first wave (in 1988) 10043 families were surveyed. In the second wave (in 1994) 4997 of these families were again surveyed and in the third wave (in 2000) only 2002 remained (≈ 20%).</p>
</section>
<section id="balancedness" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="balancedness"><span class="header-section-number">3.5</span> Balancedness</h2>
<p><strong>Balanced data structure</strong>: For each of the N observational units, data could be collected at each of the <span class="math inline">\(T\)</span> measurement points, providing a number of <span class="math inline">\(NT\)</span> observations.</p>
<p><strong>Unbalanced data structure</strong>: For at least one observational unit, measurement on at least one occasion is missing, providing <span class="math inline">\(\sum^N_{i=1} T_i\)</span> measurements (with <span class="math inline">\(T_i\)</span> denoting the number of measurements per observational unit <span class="math inline">\(i\)</span>).</p>
<p><em>Note</em> that in principle all models and methods for balanced data are applicable to unbalanced data as well. However, in case of unbalanced panel data you have to clarify the causes why values are missing, i.e.&nbsp;to specify the process leading to the missing values.</p>
</section>
<section id="peculairities" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="peculairities"><span class="header-section-number">3.6</span> Peculairities</h2>
<p>Panel data <strong>require explicit statements</strong> regarding measurement consistency over time. Do you really measure the same thing over time?</p>
<p>Panel data are in general characterized as data sets with (at least) <strong>two indices</strong>, where these two indices refer to observational units and time, or hierarchical structures, e.g.&nbsp;students in classes, multiple firms in regions, etc.</p>
<p>In biostatistics &amp; social sciences, mostly the term “longitudinal data” is used instead of “panel data”.</p>
<p><strong>Time series and cross-sectional data can be thought of as special cases of panel data:</strong> * Time series: only one panel member over several measurement points + very common in econometrics like <a href="https://www.bigdata-insider.de/was-ist-das-arima-modell-a-914956/##:~:text=Die%20Abk%C3%BCrzung%20f%C3%BCr%20ARIMA%20lautet,Zeitreihen%20beschreiben%20und%20analysieren%20lassen.">ARIMA, ARMA Models</a></p>
<ul>
<li>Cross section: many observational units (persons, firms, etc) at one time point</li>
</ul>
</section>
<section id="exercise" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="exercise"><span class="header-section-number">3.7</span> Exercise</h2>
<p><strong>Look into the Data 1</strong>: Panel data on wages in the U.S.</p>
<p>Read in:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>DAT1 <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"data/2.Example1.dta"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>How many observation for units and times:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(DAT1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4165</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>How many time points?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(DAT1<span class="sc">$</span>time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>How many units?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(DAT1<span class="sc">$</span>id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 595</code></pre>
</div>
</div>
<p>Get a summary for all variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(DAT1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       id           time        exp             wks           bluecol     
 Min.   :  1   Min.   :1   Min.   : 1.00   Min.   : 5.00   Min.   :1.000  
 1st Qu.:149   1st Qu.:2   1st Qu.:11.00   1st Qu.:46.00   1st Qu.:1.000  
 Median :298   Median :4   Median :18.00   Median :48.00   Median :2.000  
 Mean   :298   Mean   :4   Mean   :19.85   Mean   :46.81   Mean   :1.511  
 3rd Qu.:447   3rd Qu.:6   3rd Qu.:29.00   3rd Qu.:50.00   3rd Qu.:2.000  
 Max.   :595   Max.   :7   Max.   :51.00   Max.   :52.00   Max.   :2.000  
      ind             south           smsa          married     
 Min.   :0.0000   Min.   :1.00   Min.   :1.000   Min.   :1.000  
 1st Qu.:0.0000   1st Qu.:1.00   1st Qu.:1.000   1st Qu.:2.000  
 Median :0.0000   Median :1.00   Median :2.000   Median :2.000  
 Mean   :0.3954   Mean   :1.29   Mean   :1.654   Mean   :1.814  
 3rd Qu.:1.0000   3rd Qu.:2.00   3rd Qu.:2.000   3rd Qu.:2.000  
 Max.   :1.0000   Max.   :2.00   Max.   :2.000   Max.   :2.000  
      sex            union             ed            black      
 Min.   :1.000   Min.   :1.000   Min.   : 4.00   Min.   :1.000  
 1st Qu.:1.000   1st Qu.:1.000   1st Qu.:12.00   1st Qu.:1.000  
 Median :1.000   Median :1.000   Median :12.00   Median :1.000  
 Mean   :1.113   Mean   :1.364   Mean   :12.85   Mean   :1.072  
 3rd Qu.:1.000   3rd Qu.:2.000   3rd Qu.:16.00   3rd Qu.:1.000  
 Max.   :2.000   Max.   :2.000   Max.   :17.00   Max.   :2.000  
     lwage      
 Min.   :4.605  
 1st Qu.:6.395  
 Median :6.685  
 Mean   :6.676  
 3rd Qu.:6.953  
 Max.   :8.537  </code></pre>
</div>
</div>
<p>How many time points per id? Is it balanced?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#group the distinct time points by id</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>DAT1_sum <span class="ot">&lt;-</span> DAT1 <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">summarise</span>(<span class="at">N =</span> <span class="fu">n_distinct</span>(time))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># have all id 7 time points?</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>DAT1_sum<span class="sc">$</span>balanced <span class="ot">&lt;-</span> DAT1_sum<span class="sc">$</span>N <span class="sc">==</span> <span class="dv">7</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(DAT1_sum<span class="sc">$</span>balanced)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
TRUE 
 595 </code></pre>
</div>
</div>
<p>All 595 units in the data frame has 7 time points.</p>
<section id="look-into-the-data-2" class="level3" data-number="3.7.1">
<h3 data-number="3.7.1" class="anchored" data-anchor-id="look-into-the-data-2"><span class="header-section-number">3.7.1</span> Look into the Data 2:</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>DAT2 <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"data/2.Example2.dta"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>How many observation for units and times:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(DAT2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1173</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>How many time points?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(DAT2<span class="sc">$</span>year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 30</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>How many units?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(DAT2<span class="sc">$</span>state))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 46</code></pre>
</div>
</div>
<p>Is it balanced?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>DAT2_sum <span class="ot">&lt;-</span> DAT2 <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">summarise</span>(<span class="at">N =</span> <span class="fu">n_distinct</span>(year))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># have all id 7 time points?</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>DAT2_sum<span class="sc">$</span>N</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 24 25 22 26 25 27 28 23 23 21 27 26 26 29 24 29 26 25 27 24 28 23 25 27 24
[26] 21 24 26 25 25 22 26 23 24 27 27 26 27 27 26 25 28 27 29 25 29</code></pre>
</div>
</div>
<p>It ins not balanced, there is not data for all 30 years given for each state. In each state at least one data point for a year is missing.</p>
</section>
</section>
<section id="linear-panel-models" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="linear-panel-models"><span class="header-section-number">3.8</span> Linear Panel Models</h2>
<section id="notation-and-assumptions" class="level3" data-number="3.8.1">
<h3 data-number="3.8.1" class="anchored" data-anchor-id="notation-and-assumptions"><span class="header-section-number">3.8.1</span> Notation and Assumptions</h3>
<p>Based on a linear model:</p>
<p><span class="math display">\[
y= \alpha + \beta x + \epsilon
\]</span></p>
<p>But the linear model is extended:</p>
<p>The <span class="math inline">\(y\)</span> is the dependent variable and is a stacked vector → the observations of the individual is stacked, because it brackets the time points from 1 to NT →</p>
<p><span class="math display">\[
dim(y) = \sum^N_{i=1}T_i * 1
\]</span></p>
<p><span class="math inline">\(X\)</span> is a matrix of <span class="math inline">\(k\)</span> conditioning variables</p>
<p><span class="math display">\[
dim(x) = \sum^N_{i=1}T_i * k
\]</span></p>
<p>also <span class="math inline">\(\epsilon\)</span>, the vector of error terms is stacked</p>
<p><span class="math display">\[
dim(\epsilon) = \sum^N_{i=1}T_i * 1
\]</span></p>
<p><span class="math inline">\(N_T\)</span> are all observations in time of balanced structure</p>
<p>→ problem: the observations are not independent from each other</p>
<p>subsequently</p>
<p><span class="math display">\[
N_T = \sum^N_{i=1} T_i
\]</span></p>
<p>The linear model is based on the following assumptions:</p>
<p><span class="math inline">\(E[y] = X\beta\)</span> and <span class="math inline">\(E[\epsilon]= 0\)</span> (error is zero)</p>
<p><span class="math inline">\(Cov [y] = \sigma^2 | =Cov(\epsilon) = E[\epsilon\epsilon']\)</span> Covariances of <span class="math inline">\(y\)</span> and <span class="math inline">\(\epsilon\)</span> independent of each other</p>
<p>X is exogenous, not random and has a full rank → we can not be sure, what was first in a linear model and if it is not endogenous → entangle the X from Y and make sure it is not endogenous</p>
<p>Two situations yield an exogenous X:</p>
<ul>
<li>an experimental setup, where X is designed (full control of X),</li>
<li>X is assumed to be the result of a random experiment (providing y)</li>
</ul>
</section>
<section id="basic-framework-for-panel-data" class="level3" data-number="3.8.2">
<h3 data-number="3.8.2" class="anchored" data-anchor-id="basic-framework-for-panel-data"><span class="header-section-number">3.8.2</span> Basic Framework for Panel Data</h3>
<p>The basic framework for panel data is a regression of the form</p>
<p><span class="math display">\[
y_{it} = x′_{it}β + z′_iα + ϵ_{it} .
\]</span></p>
<p>There are K regressors in <span class="math inline">\(x′_{it}\)</span> , not including a constant term.</p>
<p>The heterogeneity or individual effect <span class="math inline">\(z′_iα\)</span>, where <span class="math inline">\(z′i\)</span> contains a constant term and a set of individual or group specific variables, which may be</p>
<ul>
<li>observed (such as race, sex, location), or</li>
<li>unobserved (such as family specific characteristics, individual heterogeneity in skill or preferences), → makes a lot of problems, because must be included in the model.</li>
<li>you estimate one <span class="math inline">\(\beta\)</span> for each individual effect, not for each individual.</li>
</ul>
<p>As it stands, this model is a classical regression model. If <span class="math inline">\(z′i\)</span> is observed for all individuals, then the entire model can be treated as an ordinary linear model and fit by least squares.</p>
</section>
</section>
<section id="pooled-regression" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="pooled-regression"><span class="header-section-number">3.9</span> Pooled Regression</h2>
<p>Three ways of dealing with panel data. Pooled regression is the easiest way. Pooled Regression is a homogeneous (or pooled) panel data model, because its assume that the model parameters are common across individuals. Fixed and random effects models are heterogeneous models, because they allow for any or all of the model parameters to vary across individuals. Fixed effects and random effects models are both examples of heterogeneous panel data models.</p>
<p>The panel regression formula without the <span class="math inline">\(z'i\)</span> → because it is assumed, that there are no unobservable individual-specific effects. This is a strong assumption, because with this assumed, that all the observations within groups are independent of each other.</p>
<p>→ consequently Pooled OLS ignores time and individual characteristics and focuses only on the dependencies between the individual.</p>
<p><span class="math display">\[
y_{it} = α + x′_{it}β + ϵ_{it} , i = 1, . . . , t = 1, . . . ,T_i
\]</span></p>
<p>The residuals depends on all the residual</p>
<p><span class="math display">\[
E[ϵ_{it} |x_i1, x_i2, . . . , ] = 0,
\]</span></p>
<p><span class="math display">\[
Var [ϵ_{it} |x_i1, x_i1, . . . , ] = σ^2_ϵ
\]</span></p>
<p><span class="math display">\[
Cov[ϵ_{it}ϵ_{js} |x_i1, x_i1, . . . , x_{iTj} ] = 0,
\]</span></p>
<p>if <span class="math inline">\(i \not= j\)</span> or <span class="math inline">\(t \not=s\)</span></p>
<section id="specifing-the-estimation-model" class="level3" data-number="3.9.1">
<h3 data-number="3.9.1" class="anchored" data-anchor-id="specifing-the-estimation-model"><span class="header-section-number">3.9.1</span> Specifing the estimation model</h3>
<p>In this form, if the remaining assumptions of the classical linear model are met (zero conditional mean of <span class="math inline">\(ϵ_{it}\)</span> , homoscedasticity (residuals are over time and the individuals are the same or very similar), independence across observations <span class="math inline">\(i\)</span> , and strict exogenity of <span class="math inline">\(x′it)\)</span>, then OLS is the efficient estimator and inference can reliably proceed along the linear model. However, the crux of panel data is that all these assumptions in combination are unlikely to be met.</p>
<p>The question is what can be expected of the estimator when the heterogeneity does differ across individuals?</p>
<p>We have to allow for <strong>heteroscedasticity</strong>, because data is often not fitting to homoscedasticity.</p>
<ul>
<li>Vary the classical assumptions of the linear regression model as follows and in doing so allow for heteroscedasticity and/ or autocorrelation.</li>
</ul>
<p><span class="math display">\[
E[\epsilon \epsilon']= \sum \not= \sigma^2I
\]</span></p>
<p><img src="figures/2.hetero.png" class="img-fluid" width="400"></p>
<p>At the end: an unbiased estimator for <span class="math inline">\(\beta\)</span>, which is a fixed estimator! The only entrance of randomness is the <span class="math inline">\(y\)</span>.</p>
<p>What is the issue coming, when you gave to allow for it?</p>
<p><span class="math inline">\(\beta\)</span> we get a unbiased estimator with fixed effects! It is a fixed estimator! The only entrance of randomness is the y.</p>
<p>The problem is not the <span class="math inline">\(\beta\)</span>, the problem is the covariance <span class="math inline">\(Cov(\hat{β})\)</span>. <span class="math inline">\(\sigma^2\)</span> can’t be used to give the quality of the estimator → because we have heteroscedasticity from the individuals and in time, so we cannot get the right standard errors for the estimator, because of the error term. → we don’t access the right variance in population, because the variance is influenced by parameters in units AND time!</p>
<p><strong>Problem: everything depends on everything!</strong></p>
<p>The next steps will lead us to better compute the covariance:</p>
<p><strong>Covariance matrix</strong> Note that <span class="math inline">\(Σ\)</span> is of dimension <span class="math inline">\(NT × NT\)</span> thus is a positive definite covariance matrix involving <span class="math inline">\(NT (NT + 1)/2\)</span> parameters.</p>
<ul>
<li>So for 1000 units and 5 time points, we would need to estimate 2500 parameters. NOT feasible!</li>
</ul>
<p>Which form is suited or necessary depends on the data structure?</p>
<ul>
<li>instead: for panel data analysis block diagonal structures)</li>
</ul>
<p>→ I assume, that across individuals in time is no correlation, it is assumed to be zero. Like in multi-level models, I assume that only variables in one individual (unit) separately from another individual (unit) are varying in time.</p>
<p>→ This is an estimator for the covariance matrix:</p>
<p><img src="figures/2.structure.png" class="img-fluid" width="600"></p>
<p><img src="figures/2.estimator.png" class="img-fluid" width="600"></p>
<p>autocorrelation: the estimator is an <a href="https://de.wikipedia.org/wiki/Dyadisches_Produkt">dyadic products</a>.</p>
<p>Now, we come to the formulas, we need:</p>
<p><img src="figures/2.formulas.png" class="img-fluid" width="600"></p>
<p><strong>What does it imply?</strong></p>
<p>OLS Pooled Regression treats the panel data as a single large dataset and estimates a single regression model for all observations. It ignores the individual-specific effects and assumes that the relationship between the variables is the same for all individuals. This approach does not account for the potential heterogeneity across individuals. It does not allow for intercept or slope differences among individuals. A common relationship for all individuals is assumed.</p>
</section>
<section id="robust-estimation-using-group-means" class="level3" data-number="3.9.2">
<h3 data-number="3.9.2" class="anchored" data-anchor-id="robust-estimation-using-group-means"><span class="header-section-number">3.9.2</span> Robust Estimation using Group Means</h3>
<p><strong>Between Model or Group Means Model</strong> → a group is one individual with all time points! You can also reverse the logic and group the time points over individuals.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/2.group.png" class="img-fluid figure-img" width="600"></p>
<figcaption>Group Mean Model</figcaption>
</figure>
</div>
<p>By making the averaging, you are <strong>in a heteroscedasticity setting</strong>, because you kicked out the auto correlation → then the White estimator is a robust estimator for robust standard errors:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/2.white.png" class="img-fluid figure-img" width="600"></p>
<figcaption>White Estimator</figcaption>
</figure>
</div>
<p>We have a uncertainty on the cluster level we did not have before.</p>
<p>A group mean regression estimates separate regression models for each group or individual in the panel over time. It takes into account the individual-specific effects by including group-specific intercepts or fixed effects in the regression model. This approach allows for heterogeneity across individuals and captures the differences in the relationship between the variables for each group (individuals).</p>
<p><strong>In sum</strong>: It allows for individual-specific effects and captures heterogeneity across groups or individuals in the data.</p>
</section>
<section id="example-data" class="level3" data-number="3.9.3">
<h3 data-number="3.9.3" class="anchored" data-anchor-id="example-data"><span class="header-section-number">3.9.3</span> Example Data</h3>
<p>Is build in R</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/2.data.png" class="img-fluid figure-img" width="600"></p>
<figcaption>Example Data</figcaption>
</figure>
</div>
<p><img src="figures/2.example.png" id="fig-compare" class="img-fluid" alt="Compare estimates"> There are differences in the estimates. Explanation for that follows in the excerise</p>
</section>
<section id="exercise-1" class="level3" data-number="3.9.4">
<h3 data-number="3.9.4" class="anchored" data-anchor-id="exercise-1"><span class="header-section-number">3.9.4</span> Exercise</h3>
<ol type="1">
<li>Replicate this the table from <span class="quarto-unresolved-ref">?fig-compare</span></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load data</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Wages)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>DAT <span class="ot">&lt;-</span> Wages</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># add the squared experience variable</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>DAT<span class="sc">$</span>expSq <span class="ot">&lt;-</span> DAT<span class="sc">$</span>exp<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">#add an ID</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>DAT<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">595</span>, <span class="at">each=</span><span class="dv">7</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># add a time point</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>DAT<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">595</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A panel of 595 individuals from 1976 to 1982, taken from the Panel Study of Income Dynamics (PSID).</p>
<p><strong>Variables</strong>: log wage (lwage);<br>
years of full time work experience (exp); weeks worked (wks); &nbsp;1 if blue-collar occupation, 0 if not (bluecol); &nbsp;1 if the individual works in a manufactural industry, 0 if not (ind); &nbsp;1 if the individual resides in the South, 0 if not (south); &nbsp;1 if the individual resides in an metropolitan area (smsa), 0 if not; &nbsp;1 if individual is married, 0 if not (married); &nbsp;1 if the individual wage is set by a union contract, 0 if not (union); &nbsp;years of education (ed); &nbsp;1 if the individual is female, 0 if not (sex); &nbsp;1 if the individual is black, 0 if not (black)</p>
<p>Create a model like the one from Cornwell and Rupert (1988):</p>
<p><strong>Pooled OLS Regression</strong> {#sec-ex.pool}</p>
<p>OLS can be used to pool observations of the same individual recorded at different time points. However, observations of the same individual are then treated as if they originate from other individuals. So a typical linear regression should lead to the same results as a pooled OLS regression</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>modL <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage <span class="sc">~</span> exp <span class="sc">+</span> expSq <span class="sc">+</span> wks <span class="sc">+</span> bluecol <span class="sc">+</span> ind <span class="sc">+</span> south <span class="sc">+</span> smsa <span class="sc">+</span> married <span class="sc">+</span> sex <span class="sc">+</span> union <span class="sc">+</span> ed <span class="sc">+</span> black, <span class="at">data=</span>DAT)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modL)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lwage ~ exp + expSq + wks + bluecol + ind + south + 
    smsa + married + sex + union + ed + black, data = DAT)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.18965 -0.23536 -0.00988  0.22906  2.08738 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  5.251e+00  7.129e-02  73.662  &lt; 2e-16 ***
exp          4.010e-02  2.159e-03  18.574  &lt; 2e-16 ***
expSq       -6.734e-04  4.744e-05 -14.193  &lt; 2e-16 ***
wks          4.216e-03  1.081e-03   3.899 9.82e-05 ***
bluecolyes  -1.400e-01  1.466e-02  -9.553  &lt; 2e-16 ***
ind          4.679e-02  1.179e-02   3.967 7.39e-05 ***
southyes    -5.564e-02  1.253e-02  -4.441 9.17e-06 ***
smsayes      1.517e-01  1.207e-02  12.567  &lt; 2e-16 ***
marriedyes   4.845e-02  2.057e-02   2.355   0.0185 *  
sexfemale   -3.678e-01  2.510e-02 -14.655  &lt; 2e-16 ***
unionyes     9.263e-02  1.280e-02   7.237 5.45e-13 ***
ed           5.670e-02  2.613e-03  21.702  &lt; 2e-16 ***
blackyes    -1.669e-01  2.204e-02  -7.574 4.45e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3494 on 4152 degrees of freedom
Multiple R-squared:  0.4286,    Adjusted R-squared:  0.427 
F-statistic: 259.5 on 12 and 4152 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Or alternatively: In this model we get the robust panel standard errors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>modO <span class="ot">&lt;-</span> <span class="fu">plm</span>(lwage <span class="sc">~</span> exp <span class="sc">+</span> expSq <span class="sc">+</span> wks <span class="sc">+</span> bluecol <span class="sc">+</span> ind <span class="sc">+</span> south <span class="sc">+</span> smsa <span class="sc">+</span> married <span class="sc">+</span> sex <span class="sc">+</span> union <span class="sc">+</span> ed <span class="sc">+</span> black, <span class="at">data=</span>DAT, </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">model=</span><span class="st">"pooling"</span>, <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"time"</span>))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modO, <span class="at">vcov=</span><span class="fu">vcovHC</span>(modO, <span class="at">method=</span><span class="st">"arellano"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pooling Model

Note: Coefficient variance-covariance matrix supplied: vcovHC(modO, method = "arellano")

Call:
plm(formula = lwage ~ exp + expSq + wks + bluecol + ind + south + 
    smsa + married + sex + union + ed + black, data = DAT, model = "pooling", 
    index = c("id", "time"))

Balanced Panel: n = 595, T = 7, N = 4165

Residuals:
      Min.    1st Qu.     Median    3rd Qu.       Max. 
-2.1896534 -0.2353558 -0.0098805  0.2290643  2.0873770 

Coefficients:
               Estimate  Std. Error t-value  Pr(&gt;|t|)    
(Intercept)  5.2511e+00  1.2326e-01 42.6005 &lt; 2.2e-16 ***
exp          4.0105e-02  4.0671e-03  9.8607 &lt; 2.2e-16 ***
expSq       -6.7338e-04  9.1106e-05 -7.3911 1.751e-13 ***
wks          4.2161e-03  1.5384e-03  2.7405 0.0061609 ** 
bluecolyes  -1.4001e-01  2.7181e-02 -5.1511 2.710e-07 ***
ind          4.6789e-02  2.3609e-02  1.9818 0.0475634 *  
southyes    -5.5637e-02  2.6100e-02 -2.1317 0.0330876 *  
smsayes      1.5167e-01  2.4048e-02  6.3069 3.143e-10 ***
marriedyes   4.8449e-02  4.0850e-02  1.1860 0.2356910    
sexfemale   -3.6779e-01  4.5470e-02 -8.0885 7.858e-16 ***
unionyes     9.2627e-02  2.3618e-02  3.9219 8.927e-05 ***
ed           5.6704e-02  5.5519e-03 10.2135 &lt; 2.2e-16 ***
blackyes    -1.6694e-01  4.4228e-02 -3.7745 0.0001626 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Total Sum of Squares:    886.9
Residual Sum of Squares: 506.77
R-Squared:      0.42861
Adj. R-Squared: 0.42696
F-statistic: 66.2142 on 12 and 594 DF, p-value: &lt; 2.22e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Check if same </span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>stargazer<span class="sc">::</span><span class="fu">stargazer</span>(modO,modL, <span class="at">type=</span><span class="st">"text"</span>, <span class="at">out =</span> <span class="st">"ml.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
========================================================
                                Dependent variable:     
                            ----------------------------
                                       lwage            
                              panel           OLS       
                              linear                    
                               (1)            (2)       
--------------------------------------------------------
exp                          0.040***      0.040***     
                             (0.002)        (0.002)     
                                                        
expSq                       -0.001***      -0.001***    
                            (0.00005)      (0.00005)    
                                                        
wks                          0.004***      0.004***     
                             (0.001)        (0.001)     
                                                        
bluecolyes                  -0.140***      -0.140***    
                             (0.015)        (0.015)     
                                                        
ind                          0.047***      0.047***     
                             (0.012)        (0.012)     
                                                        
southyes                    -0.056***      -0.056***    
                             (0.013)        (0.013)     
                                                        
smsayes                      0.152***      0.152***     
                             (0.012)        (0.012)     
                                                        
marriedyes                   0.048**        0.048**     
                             (0.021)        (0.021)     
                                                        
sexfemale                   -0.368***      -0.368***    
                             (0.025)        (0.025)     
                                                        
unionyes                     0.093***      0.093***     
                             (0.013)        (0.013)     
                                                        
ed                           0.057***      0.057***     
                             (0.003)        (0.003)     
                                                        
blackyes                    -0.167***      -0.167***    
                             (0.022)        (0.022)     
                                                        
Constant                     5.251***      5.251***     
                             (0.071)        (0.071)     
                                                        
--------------------------------------------------------
Observations                  4,165          4,165      
R2                            0.429          0.429      
Adjusted R2                   0.427          0.427      
Residual Std. Error                    0.349 (df = 4152)
F Statistic (df = 12; 4152) 259.544***    259.544***    
========================================================
Note:                        *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
</div>
<p>Leads to the same results.</p>
<p>Check also for standard errors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>modL_robust_se <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">summary</span>(modL,<span class="at">robust =</span> T)<span class="sc">$</span>coefficients[,<span class="st">"Std. Error"</span>])</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>modO_robust_se <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">summary</span>(modO,<span class="at">robust =</span> T)<span class="sc">$</span>coefficients[,<span class="st">"Std. Error"</span>])</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(modL_robust_se,modO_robust_se)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   modL_robust_se modO_robust_se
1    7.128679e-02   7.128679e-02
2    2.159175e-03   2.159175e-03
3    4.744313e-05   4.744313e-05
4    1.081366e-03   1.081366e-03
5    1.465670e-02   1.465670e-02
6    1.179350e-02   1.179350e-02
7    1.252710e-02   1.252710e-02
8    1.206870e-02   1.206870e-02
9    2.056867e-02   2.056867e-02
10   2.509705e-02   2.509705e-02
11   1.279951e-02   1.279951e-02
12   2.612826e-03   2.612826e-03
13   2.204219e-02   2.204219e-02</code></pre>
</div>
</div>
<p><strong>Group Mean pooled regression</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>modG <span class="ot">&lt;-</span> <span class="fu">plm</span>(lwage <span class="sc">~</span> exp <span class="sc">+</span> expSq <span class="sc">+</span> wks <span class="sc">+</span> bluecol <span class="sc">+</span> ind <span class="sc">+</span> south <span class="sc">+</span> smsa <span class="sc">+</span> married <span class="sc">+</span> sex <span class="sc">+</span> union <span class="sc">+</span> ed <span class="sc">+</span> black, <span class="at">data=</span>DAT, </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">model=</span><span class="st">"between"</span>, <span class="co">#choose this argument for using group means of individuals</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"time"</span>)) </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modG) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Oneway (individual) effect Between Model

Call:
plm(formula = lwage ~ exp + expSq + wks + bluecol + ind + south + 
    smsa + married + sex + union + ed + black, data = DAT, model = "between", 
    index = c("id", "time"))

Balanced Panel: n = 595, T = 7, N = 4165
Observations used in estimation: 595

Residuals:
      Min.    1st Qu.     Median    3rd Qu.       Max. 
-0.8268412 -0.1816744  0.0039229  0.1867997  0.7169636 

Coefficients:
               Estimate  Std. Error t-value  Pr(&gt;|t|)    
(Intercept)  5.12143093  0.20424937 25.0744 &lt; 2.2e-16 ***
exp          0.03190113  0.00477687  6.6783 5.656e-11 ***
expSq       -0.00056563  0.00010485 -5.3945 1.001e-07 ***
wks          0.00918910  0.00360440  2.5494 0.0110457 *  
bluecolyes  -0.16761971  0.03381666 -4.9567 9.416e-07 ***
ind          0.05791753  0.02554122  2.2676 0.0237187 *  
southyes    -0.05705355  0.02596784 -2.1971 0.0284078 *  
smsayes      0.17577535  0.02575680  6.8244 2.222e-11 ***
marriedyes   0.11478166  0.04769750  2.4065 0.0164190 *  
sexfemale   -0.31706119  0.05472529 -5.7937 1.128e-08 ***
unionyes     0.10906865  0.02923185  3.7312 0.0002093 ***
ed           0.05143597  0.00555456  9.2601 &lt; 2.2e-16 ***
blackyes    -0.15780429  0.04501188 -3.5058 0.0004902 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Total Sum of Squares:    92.322
Residual Sum of Squares: 42.073
R-Squared:      0.54428
Adj. R-Squared: 0.53489
F-statistic: 57.926 on 12 and 582 DF, p-value: &lt; 2.22e-16</code></pre>
</div>
</div>
<p>Compare:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(modL, modG, <span class="at">type=</span><span class="st">"text"</span>, <span class="at">out =</span> <span class="st">"ml.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=======================================================================
                                    Dependent variable:                
                    ---------------------------------------------------
                                           lwage                       
                               OLS                      panel          
                                                        linear         
                               (1)                       (2)           
-----------------------------------------------------------------------
exp                          0.040***                  0.032***        
                             (0.002)                   (0.005)         
                                                                       
expSq                       -0.001***                 -0.001***        
                            (0.00005)                  (0.0001)        
                                                                       
wks                          0.004***                  0.009**         
                             (0.001)                   (0.004)         
                                                                       
bluecolyes                  -0.140***                 -0.168***        
                             (0.015)                   (0.034)         
                                                                       
ind                          0.047***                  0.058**         
                             (0.012)                   (0.026)         
                                                                       
southyes                    -0.056***                  -0.057**        
                             (0.013)                   (0.026)         
                                                                       
smsayes                      0.152***                  0.176***        
                             (0.012)                   (0.026)         
                                                                       
marriedyes                   0.048**                   0.115**         
                             (0.021)                   (0.048)         
                                                                       
sexfemale                   -0.368***                 -0.317***        
                             (0.025)                   (0.055)         
                                                                       
unionyes                     0.093***                  0.109***        
                             (0.013)                   (0.029)         
                                                                       
ed                           0.057***                  0.051***        
                             (0.003)                   (0.006)         
                                                                       
blackyes                    -0.167***                 -0.158***        
                             (0.022)                   (0.045)         
                                                                       
Constant                     5.251***                  5.121***        
                             (0.071)                   (0.204)         
                                                                       
-----------------------------------------------------------------------
Observations                  4,165                      595           
R2                            0.429                     0.544          
Adjusted R2                   0.427                     0.535          
Residual Std. Error     0.349 (df = 4152)                              
F Statistic         259.544*** (df = 12; 4152) 57.926*** (df = 12; 582)
=======================================================================
Note:                                       *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
</div>
<p>In both models I have included all explanatory and control variables and regress them from the natural log in Wage for all units.</p>
<p>In both models all included variables are significant and have an effect in the same direction.</p>
<p><strong>Our explanatory variable</strong> we are interested in is the return to education, which is grasped by the variable Ed. The effect of this variable is quite similar in both models, but in the second one a bit smaller.</p>
<p>Variables with similar estimates and robust standard errors in both models:</p>
<ul>
<li>exp - years full of work experience</li>
<li>expSq - years full of work experience squared</li>
<li>bluecolyes - in blue collar occupation</li>
<li>southyes - reside in south</li>
<li>smsa - resides in metropolian area</li>
<li>union - part of a union</li>
<li>black - if a person is black</li>
</ul>
<p>Variables with different estimates and robust standard errors in both models:</p>
<ul>
<li>wks - weeks of work, the estimate in the second model is more than twice as high than in the first</li>
<li>married- if a person is married, the estimate in the second model is more than twice as high than in the first.</li>
</ul>
<p><strong>Why is this the case?</strong></p>
<ul>
<li>The OLS and the Panel Robust Standard error are for considering time points variation for one individual (more appropriate within level) → its accounting for period heteroscedasticity</li>
<li>The group mean regression and the White Robust S.E. are for considering individual variance across time (within level variation comparing between variation) → accounting for cross-sectional heteroscedasticity.</li>
<li>Marriage and weeks worked are indicators, that vary over time. The group mean estimator account for cross-sectional heteroscedasticity, not for periodical. But effects of worked week and marriage are changing with time. So when you make for example a group effect of people who are married , they earn way more than people who are never been married. But in this group model different time effects are not included and it can be, that in the beginning of a marriage the effect is small and grows over time, because you get older and more experienced etc., too. So the time being married and the differences in the impact of marriage on earning are not included.</li>
<li>On the other hand the modG cancels autocorrelation out and allows for individual specific variations.</li>
</ul>
<p><strong>ANOVA for investigating variance</strong> Depending on the model, we have different estimators. Where comes the differences from? From the individual or the time level? Therefore, we do an ANOVA.</p>
<p>We fit first e linear regression for the individual:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage<span class="sc">~</span>id, <span class="at">data=</span>DAT)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: lwage
            Df Sum Sq Mean Sq F value    Pr(&gt;F)    
id           1   7.07  7.0655  33.431 7.927e-09 ***
Residuals 4163 879.84  0.2113                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The <a href="https://arc.lib.montana.edu/book/statistics-with-r-textbook/item/56">ANOVA</a> tells us that there is a significant difference in the means of an individual over time.</p>
<p>The total sum of squares (the total variation across all units) is 886.91.</p>
<p>It shows the <strong>within</strong> variation with the residuals of the individual (the mean squared error of the residuals estimates the variation of the errors around the group means, the MSE)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>within <span class="ot">&lt;-</span> <span class="fu">anova</span>(fit)[<span class="st">"Residuals"</span>, <span class="st">"Mean Sq"</span>]; within</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2113475</code></pre>
</div>
</div>
<p>What differs, when a variable of the individual level changes? I.e. what changes for the individual, when he/she gets married?</p>
<p><strong>Between</strong> variance with individuals (estimates the varianceof the different group or in this case means for the individuals around the grand mean):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>between <span class="ot">&lt;-</span> <span class="fu">anova</span>(fit)[<span class="st">"id"</span>, <span class="st">"Mean Sq"</span>]; between</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.065452</code></pre>
</div>
</div>
<p>So this gives us an insight, i. e. what differs for the group of individuals that is married in comparison to the group that is not married?</p>
<p>Next step: What variance is there all over?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>total <span class="ot">&lt;-</span> between <span class="sc">+</span> within; total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.276799</code></pre>
</div>
</div>
<p>Because the variance in the mean squared for ID is much larger than the mean squared error, the F-ratio is not nearly close to 1 and we have a signifcant value to reject the null hypothesis, that there are no differences in means between the indivduals.</p>
<p>Steps described generally:</p>
<pre><code>## anov &lt;- aov(lwage~id+Error(id),data=DAT)
## summary(anov)
## grandmean &lt;- as.vector(anov$"(Intercept)"[[1]][1])
## msq_with &lt;- summary(anov)$"Error: Within"[[1]]$"Mean Sq" ## Mean Squared Error for within group variance (for group = individuals)
## dfId &lt;- summary(anov)$"Error: id"[[1]]$"Df"
## dfWithin &lt;- summary(anov)$"Error: Within"[[1]]$"Df"
## msq_bet &lt;- summary(anov)$"Error: id"[[1]]$"Mean Sq" ## Mean Squared Error for between group variance (for group = individuals)
## between &lt;- (msq_bet-msq_with)/((dfWithin/(dfId+1))+1) ## (S1^2-S2^2)/J
## total &lt;- msq_bet + msq_with
## msq_with ## within ok
## msq_bet ## between ok
## total </code></pre>
</section>
</section>
<section id="fixed-effects-model" class="level2" data-number="3.10">
<h2 data-number="3.10" class="anchored" data-anchor-id="fixed-effects-model"><span class="header-section-number">3.10</span> Fixed Effects Model</h2>
<p>No random component added to <span class="math inline">\(\beta\)</span>. The fixed effects model arises from the assumption that omitted effects, <span class="math inline">\(c_i\)</span> , in the general model</p>
<p><span class="math display">\[
y_{it} = x′_{it}β + c_i + ϵ_{it}
\]</span></p>
<p>are correlated with the included variables, i.e.</p>
<p><span class="math display">\[
E[c_i |X_i ] = h(X_i).
\]</span></p>
<p><strong>Assumption</strong>: <span class="math inline">\(C_i\)</span>, the “unobservable” effect of omitted effects are correlated to the observable and included variables.</p>
<p>Unobservable effects could be motivations, personality traits.</p>
<p>Example: The chance of marriage is not only explained by the x, but dependent on the x conditioned by c.</p>
<p>Since the conditional means is the same in every period, it gives the unobserved effect a home, because it is conditional over time and dependent on the observed variables.</p>
<p><span class="math display">\[
y_{it} = x′_{it}β + h(X_i ) + ϵ_{it} + [c_i − h(X_i )]\\
= x′_{it}β + α_i + ϵ_{it} + [c_i − h(X_i)].
\]</span></p>
<p>$ h(X_i )$ is the unobserved, what I observed on the other variables → this is the fixed effect.</p>
<p>By design the bracket term is uncorrelated with Xi , thus we may absorb it in the disturbance:</p>
<p><span class="math display">\[
y_{it} = x′_{it}β + α_i + ϵ_{it} .
\]</span></p>
<p>A further assumption is that <span class="math inline">\(Var (ci |Xi )\)</span> is constant. Thus the model above is a classical linear regression model.</p>
<p>→ what we have in conclusion is a linear model.</p>
<p>The fixed effects formulation implies that differences across groups can be captures in differences in the constant term. Each <span class="math inline">\(α_i\)</span> is treated as an unknown parameter to be estimated.</p>
<p>The major shortcoming of the fixed effects approach is that any time-invariant variable in the set of explanatory variables will mimic the individual specific constant term.</p>
<p>That is, the fixed effects formulation of the model absorbs the all time-invariant terms in the regression in <span class="math inline">\(α_i\)</span> .</p>
<p>Thus the coefficient on the time-invariant variables cannot be estimated. (Hence, fixed effects models cannot be used to investigate time-invariant causes of the dependent variables.)</p>
<p>This lack of identification is the price of robustness of the specification to unmeasured correlation between the omitted effects and the included variables.</p>
<p>→ it is not possible to get an estimate for constant variables over time.</p>
<p>If you want to compare groups, use group means: Then, you can infer, what a belonging to a certain gender, an age cohort, an occupation has on the individual or on the group.</p>
<p><strong>The fixed effects model is useful to investigate dynamics</strong>: Here, you get rid of all constant factors in holding them fixed. Your focus here is to estimate differences in time, like enter a new job, get married, or external shocks like inflation.</p>
<p><strong>In sum</strong>, the fixed effect model is useful whenever you are only interested in analyzing the impact of variables that vary over time (the time effects).</p>
<p>The fixed-effects model controls for all time-invariant differences between the individuals: estimated coefficients cannot be biased because of omitted time-invariant characteristics. Technically, time-invariant characteristics of the individuals are perfectly collinear with the group dummies.</p>
<p><strong>Fixed effects models serve to study the causes of changes within a group/person</strong>.A time-invariant characteristic cannot cause such a change, because it is constant for each group/person.</p>
<p>Important: You cannot control for everything! So, you must assume, that the constants are not changing over time.</p>
<section id="least-suqares-dummy-variable-model-lsdv" class="level3" data-number="3.10.1">
<h3 data-number="3.10.1" class="anchored" data-anchor-id="least-suqares-dummy-variable-model-lsdv"><span class="header-section-number">3.10.1</span> Least suqares dummy variable model (LSDV)</h3>
<p>BUT: you can reduce the <span class="math inline">\(\alpha\)</span> estimates:</p>
<p><img src="figures\2.fixed-estimator.png" class="img-fluid" width="700"></p>
<p>Because too many estimates:</p>
</section>
<section id="partioned-regression" class="level3" data-number="3.10.2">
<h3 data-number="3.10.2" class="anchored" data-anchor-id="partioned-regression"><span class="header-section-number">3.10.2</span> Partioned Regression</h3>
<p><img src="figures\2.fixed-part.png" class="img-fluid" width="700"></p>
<p>(The Frisch-Waugh-Lovell theorem states that) in this regression the residuals <span class="math inline">\(\hatϵ\)</span> and the OLS estimate <span class="math inline">\(\hatβ_2\)</span> will be numerically identical to the residuals and the OLS estimate for <span class="math inline">\(β_2\)</span> in the following regression: <span class="math display">\[
M_1y = M_1X_2β_2 + η
\]</span> where <span class="math inline">\(M_1\)</span> is the annihilator matrix for the regressors <span class="math inline">\(X_1\)</span>. The theorem states that having a regression with a constant and another regressor is equivalent to subtracting the means from the dependent variable and the regressor and then running the regression for the demeaned variables but without the constant term.</p>
<p>For each of the observed points you subtract the mean, so <span class="math inline">\(y+TN - \overline{y}_N\)</span></p>
<p>→ you standardized your <span class="math inline">\(y\)</span> over the time. Also often called <em>demeaned regression</em>. You get rid of the part of the model you are not interesting in. You transform your y into another y, which is free from the constants.</p>
</section>
<section id="consistency-if-partitioned-regression-estimator" class="level3" data-number="3.10.3">
<h3 data-number="3.10.3" class="anchored" data-anchor-id="consistency-if-partitioned-regression-estimator"><span class="header-section-number">3.10.3</span> Consistency if partitioned regression estimator</h3>
<p>Thus, as long as the data is well behaving and number <span class="math inline">\(N\)</span> of individual units is large, we can expect consistency of <span class="math inline">\(\hatβ\)</span>. However, this is mostly not true for <span class="math inline">\(\hatα_i\)</span> : if <span class="math inline">\(T\)</span> is small, <span class="math inline">\(\hatα_i\)</span> is an inconsistent estimator of <span class="math inline">\(α_i\)</span> (this is the individual effect).</p>
<p>So you should test for <span class="math inline">\(\hatα_i\)</span><br>
</p>
<p>Example for <span class="math inline">\(\beta\)</span> :</p>
<ul>
<li>what is the effect of entering marriage on wages?</li>
<li>how large is the new task of taking informal care for relatives or intensify your care, what does it make with the well-being?</li>
</ul>
<p>Example for <span class="math inline">\(\alpha\)</span> :</p>
<ul>
<li>personality traits in the effect of entering marriage on wages?</li>
<li>intrinsic motivation in taking care for relatives or intensify your care</li>
</ul>
<p>→ <span class="math inline">\(\alpha\)</span> is not what we are interesting in, but it does play a role, specific for each individual, not a parameter for a feature like <span class="math inline">\(\beta\)</span>!</p>
</section>
<section id="testing-with-the-f-test" class="level3" data-number="3.10.4">
<h3 data-number="3.10.4" class="anchored" data-anchor-id="testing-with-the-f-test"><span class="header-section-number">3.10.4</span> Testing with the F-Test</h3>
<p><img src="figures\2.F.png" class="img-fluid" width="700"></p>
</section>
<section id="exercise-2" class="level3" data-number="3.10.5">
<h3 data-number="3.10.5" class="anchored" data-anchor-id="exercise-2"><span class="header-section-number">3.10.5</span> Exercise</h3>
<p><strong>Least squares dummy variable model</strong></p>
<p>1.Estimate a fixed effects model with <code>lwage</code> as dependent variable and the regressors described before (where possible). For that purpose, use the LSDV approach. Mind that in this model there is no grand mean but group specific intercepts. In R, you omit the grand mean from estimation by adding ‘-1’ to the right side of the regression equation and you get group specific effects by defining the related group identifiers as factors ‘as.factor()’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use the same explanatory and control variables as before but exclude all time invariant factors. This is, because they are mimiced by the dummies for id. </span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>fixed_lsdv <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage <span class="sc">~</span> <span class="fu">as.factor</span>(id) <span class="co">#include the group specific effect</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">+</span> exp <span class="sc">+</span> expSq <span class="sc">+</span> wks <span class="sc">+</span> bluecol <span class="sc">+</span> ind <span class="sc">+</span> south <span class="sc">+</span> smsa <span class="sc">+</span> married <span class="sc">+</span> union</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">-</span><span class="dv">1</span>, <span class="co">#subtract the grand mean from the estimation</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data=</span>DAT) </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fixed_lsdv) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>the <code>summary(fixed_lsdv)</code> gives you all estimates for each individual (in this data set 595 individuals) and estimates for each explanatory and control variable. A look in taht output shows, that all the estimates for the ids are significant and ranges from 3 to over 6.</p>
<p>But we are not interested in the data overfitting estimates for each individual, we are interested in the other variables.</p>
<p>When we want to have only the coefficients, this code is useful:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fixed_lsdv<span class="sc">$</span>coefficients[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">595</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          exp         expSq           wks    bluecolyes           ind 
 0.1132082750 -0.0004183513  0.0008359460 -0.0214764983  0.0192101222 
     southyes       smsayes    marriedyes      unionyes 
-0.0018611924 -0.0424691528 -0.0297258386  0.0327848598 </code></pre>
</div>
</div>
<p>Compared to the group mean model and the pooled regression the estimates have changed a lot. This is, because the LSDV model is only capable of modelling dynamics, so how an individual with certain heterogenity is changing over time because of different variables. The OLS regression does not account for individual specific effects and the group mean not for individual changings over time. It depends on the question and the theoretical framework, which model is appropriate to get the right estimates. With the estimates of the fixed effect model we analyze dynamics for individuals. So: What does marriage have for an effect on the wage of an individual?</p>
<p>Because many <span class="math inline">\(\alpha\)</span> terms, if <span class="math inline">\(N\)</span> gets larger, not feasible (so I have spare to print the summary of that model)</p>
<p><strong>partioned regression / within estimator</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fixed_w <span class="ot">&lt;-</span> <span class="fu">plm</span>(lwage <span class="sc">~</span> exp <span class="sc">+</span> expSq <span class="sc">+</span> wks <span class="sc">+</span> bluecol <span class="sc">+</span> ind <span class="sc">+</span> south <span class="sc">+</span> smsa <span class="sc">+</span> married <span class="sc">+</span> union, <span class="at">data=</span>DAT, <span class="at">model=</span><span class="st">"within"</span>, <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"time"</span>)) </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fixed_w) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Oneway (individual) effect Within Model

Call:
plm(formula = lwage ~ exp + expSq + wks + bluecol + ind + south + 
    smsa + married + union, data = DAT, model = "within", index = c("id", 
    "time"))

Balanced Panel: n = 595, T = 7, N = 4165

Residuals:
      Min.    1st Qu.     Median    3rd Qu.       Max. 
-1.8122282 -0.0519417  0.0038855  0.0614706  1.9434306 

Coefficients:
              Estimate  Std. Error t-value  Pr(&gt;|t|)    
exp         1.1321e-01  2.4710e-03 45.8141 &lt; 2.2e-16 ***
expSq      -4.1835e-04  5.4595e-05 -7.6629 2.329e-14 ***
wks         8.3595e-04  5.9967e-04  1.3940   0.16340    
bluecolyes -2.1476e-02  1.3784e-02 -1.5581   0.11930    
ind         1.9210e-02  1.5446e-02  1.2437   0.21370    
southyes   -1.8612e-03  3.4299e-02 -0.0543   0.95673    
smsayes    -4.2469e-02  1.9428e-02 -2.1859   0.02889 *  
marriedyes -2.9726e-02  1.8984e-02 -1.5659   0.11747    
unionyes    3.2785e-02  1.4923e-02  2.1970   0.02809 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Total Sum of Squares:    240.65
Residual Sum of Squares: 82.267
R-Squared:      0.65815
Adj. R-Squared: 0.60026
F-statistic: 761.751 on 9 and 3561 DF, p-value: &lt; 2.22e-16</code></pre>
</div>
</div>
<p>The results for the least squares dummy regression and the partioned regression are the same. Like the LSDV the partioned regression also estimates the effect of the dynamic for each individual.</p>
<p><strong>pooled model als a null model</strong></p>
<p>While the partioned regression take individual specifics and time dynamics into account, the pooled one does not and only account for heteroscedasticity of periods. Therefore, we should test, what the better model is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>pooled <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage <span class="sc">~</span> exp <span class="sc">+</span> expSq <span class="sc">+</span> bluecol <span class="sc">+</span> ind <span class="sc">+</span> south <span class="sc">+</span> smsa <span class="sc">+</span> married <span class="sc">+</span> sex <span class="sc">+</span> union <span class="sc">+</span> ed <span class="sc">+</span> black, <span class="at">data=</span>DAT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To compare this model to the other, we use the function <a href="https://bookdown.org/ccolonescu/RPoE4/panel-data-models.html"><code>pFtest</code></a>. This function is a F Test for individual and time effects and is written for the comparison of pooled and partioned regression models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test on common significance of dummies for groups/ individuals</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pFtest</span>(fixed_w, <span class="co">#first argument has to be the fixed model</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>       pooled) <span class="co">#second argument the pooled one</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    F test for individual effects

data:  lwage ~ exp + expSq + wks + bluecol + ind + south + smsa + married +  ...
F = 31.174, df1 = 592, df2 = 3561, p-value &lt; 2.2e-16
alternative hypothesis: significant effects</code></pre>
</div>
</div>
<p>With an F of 31 and this number of degrees of freedom, the F test for individual effects is significant. We must reject the null hypothesis, that there are no fixed individual effects.</p>
<p>Regarding the F-test in which a pooled regression and a fixed effect model are compared to each other, we should go with an fixed effect model.</p>
<p>The fixed effects model models dynamics over time. The unobserved factors are not captured by the control variables, “the something in the back”. In the fixed effects model, though, the something in the back is conditioned by the observed variables, like assumed in the fixed effects model.</p>
</section>
</section>
<section id="random-effects-model" class="level2" data-number="3.11">
<h2 data-number="3.11" class="anchored" data-anchor-id="random-effects-model"><span class="header-section-number">3.11</span> Random Effects Model</h2>
<p><em>Note</em>: In the following we learn typical problems with random effects models with panel data. This problems are also true multi-level random models!</p>
<section id="ideas" class="level3" data-number="3.11.1">
<h3 data-number="3.11.1" class="anchored" data-anchor-id="ideas"><span class="header-section-number">3.11.1</span> Ideas</h3>
<p>The fixed effects model allows the unobserved individual effects to be correlated with the included variables.</p>
<p>As a consequence, the differences between units are strictly modeled as parametric shifts of the regression function. → for people who are not in the sample, we cannot predict for! This model might be viewed as applying only to the cross-sectional units in the study, not to additional ones outside the sample.</p>
<p>Main idea for random effects models: The individual-specific effect is a random variable is uncorrelated with the explanatory variables.</p>
<p>The variation across entities is assumed to be random and uncorrelated to the predictor or independent variables in the model.</p>
</section>
<section id="model-specification" class="level3" data-number="3.11.2">
<h3 data-number="3.11.2" class="anchored" data-anchor-id="model-specification"><span class="header-section-number">3.11.2</span> Model specification</h3>
<p>If <span class="math inline">\(N\)</span> is large, one may view the ‘effects’ as unobserved random variables and not as incidental parameters: random effects (RE). The model becomes more ‘parsimonious’, as it has less parameter</p>
<ul>
<li>so random effects models are attractive for large <span class="math inline">\(N\)</span> and small <span class="math inline">\(T\)</span></li>
<li><strong>Assumption</strong>: If the individual effects are strictly uncorrelated with the regressors, then it might be appropriate to model the individual specific constant terms as randomly distributed across cross-sectional units.</li>
</ul>
<p><a href="https://libguides.princeton.edu/stata-panel-fe-re"><strong>Short explanation of the concept:</strong></a></p>
<ul>
<li>( If individual effects are strictly uncorrelated with the regressors, it may be appropriate to model the individual specific constant terms as randomly distributed across cross-sectional units. This view would be appropriate if we believe that sampled cross-sectional units were drawn from a large population.</li>
<li>If you have reason to believe that differences across entities have some influence on your dependent variable, then you should use random effects. In a random effects model, you need to specify those individual characteristics that may or may not influence the predictor variables. The problem with this is that data on some variables (i.e., individual characteristics such as innate ability) may not be available, hence leading to omitted variable bias in the model.</li>
<li>An advantage of using random effects method is that you can include time invariant variables (e.g., geographical contiguity, distance between states) in your model. In the fixed effects model, these variables are absorbed by the intercept.</li>
</ul>
<p><a href="https://bookdown.org/ccolonescu/RPoE4/panel-data-models.html#the-random-effects-model"><strong>Another advantage:</strong></a> The random effects model elaborates on the fixed effects model by recognizing that, since the individuals in the panel are randomly selected, their characteristics, measured by the intercept <span class="math inline">\(β_{1i}\)</span> should also be random.</p>
<p><strong>The payoff to this form is that it greatly reduces the number of parameters to be estimated.</strong></p>
<p>!The cost is the possibility of inconsistent estimates, should the assumption turn out to be inappropriate! → if there is correlation with unobserved part and the variables included in the model, you get wrong estimates!</p>
<p>the unobserved individual heterogeneity can be assumed to be uncorrelated with the included variables, then the model may be formulated as</p>
<p><span class="math display">\[
\\
y_{it} = x′_{it}β + E[z′iα] + {z′iα − E[z′
iα]} + ϵ_{it} \\
= x′_{it}β + (α + u_i ) + ϵ_{it}
\\
\]</span></p>
<p>where there are <span class="math inline">\(K\)</span> regressors including a constant and the single constant term is the mean of the unobserved heterogeneity, <span class="math inline">\(E[z′iα]\)</span>. In a random effects model I assume that <span class="math inline">\(α\)</span> is the same for everybody, so all individuals get the same intercept, I assume everybody is the same.</p>
<p>The shaky part is <span class="math inline">\(u_i\)</span>, the part hold responsible for the variance. It is this: <span class="math inline">\(\{z′iα] − E[z′iα]\}\)</span>.</p>
<p>In this case, it is not <span class="math inline">\(\tau^2\)</span>, it is <span class="math inline">\(\sigma^2\)</span> that explain the variance of the group deviation, the <span class="math inline">\(u_i\)</span>.</p>
<p>The component <span class="math inline">\(u_i\)</span> is the random heterogeneity specific to the with observation and is constant through time. So you don’t have to estimate for each individual a certain constant parameter. BUT: This comes with a price!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/2.random-assumption.png" class="img-fluid figure-img" width="600"></p>
<figcaption>Assumption</figcaption>
</figure>
</div>
<p><img src="figures/2.random.png" class="img-fluid" width="600" alt="Residual Variance"> <img src="figures/2.random2.png" class="img-fluid" width="600" alt="Covariance"></p>
</section>
<section id="least-squares-estimation" class="level3" data-number="3.11.3">
<h3 data-number="3.11.3" class="anchored" data-anchor-id="least-squares-estimation"><span class="header-section-number">3.11.3</span> Least Squares Estimation</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/2.random3.png" class="img-fluid figure-img" width="600"></p>
<figcaption>Least Squares Estimation</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/2.ordinary.png" class="img-fluid figure-img" width="600"></p>
<figcaption>wihtin and between group estimtors</figcaption>
</figure>
</div>
</section>
<section id="generalized-least-squares" class="level3" data-number="3.11.4">
<h3 data-number="3.11.4" class="anchored" data-anchor-id="generalized-least-squares"><span class="header-section-number">3.11.4</span> Generalized Least Squares</h3>
<p><img src="figures/2.general.png" class="img-fluid" width="600" alt="GLS"> Only true for random effects model!</p>
<p>weighting the data in the estimating procedure, making full use of the data, because between and within-group is regarded in this model.</p>
<p><img src="figures/2.general2.png" class="img-fluid" width="600" alt="weighting of data"> Testing Random Effects with the <strong>Lagrange multipliert test</strong>:</p>
<p>$ H_0: _u = 0$ (or <span class="math inline">\(Corr(w_{it, W_is})= 0)\)</span> <span class="math inline">\(H_1: \sigma^2_u \not= 0\)</span></p>
<p>Under the null hypothesis, LM is distributed as chi-squared with one degree of freedom.</p>
</section>
<section id="exercise-3" class="level3" data-number="3.11.5">
<h3 data-number="3.11.5" class="anchored" data-anchor-id="exercise-3"><span class="header-section-number">3.11.5</span> Exercise</h3>
<ol type="1">
<li>Estimate a random effects model.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>random <span class="ot">&lt;-</span> <span class="fu">plm</span>(lwage <span class="sc">~</span> exp <span class="sc">+</span> expSq <span class="sc">+</span> wks <span class="sc">+</span> bluecol <span class="sc">+</span> ind <span class="sc">+</span> south <span class="sc">+</span> smsa <span class="sc">+</span> married <span class="sc">+</span> sex <span class="sc">+</span> union <span class="sc">+</span> ed <span class="sc">+</span> black, </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> DAT, <span class="at">model =</span> <span class="st">"random"</span>, <span class="co"># specify model</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">random.method =</span> <span class="st">"amemiya"</span>, <span class="co">#stands for the Amemiya-MacCurdy estimation</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>              index <span class="co">#use this method</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>              <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"time"</span>), <span class="at">effect=</span><span class="st">"individual"</span>) <span class="co"># define the effect, do you think its the individual or time? </span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(random)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Oneway (individual) effect Random Effect Model 
   (Amemiya's transformation)

Call:
plm(formula = lwage ~ exp + expSq + wks + bluecol + ind + south + 
    smsa + married + sex + union + ed + black, data = DAT, effect = "individual", 
    model = "random", random.method = "amemiya", index = c("id", 
        "time"))

Balanced Panel: n = 595, T = 7, N = 4165

Effects:
                  var std.dev share
idiosyncratic 0.02304 0.15180 0.021
individual    1.06368 1.03135 0.979
theta: 0.9445

Residuals:
      Min.    1st Qu.     Median    3rd Qu.       Max. 
-1.9129800 -0.0679600  0.0073847  0.0742140  2.0130032 

Coefficients:
               Estimate  Std. Error z-value Pr(&gt;|z|)    
(Intercept)  3.0303e+00  2.0907e-01 14.4944  &lt; 2e-16 ***
exp          1.0915e-01  2.4055e-03 45.3760  &lt; 2e-16 ***
expSq       -4.8419e-04  5.3138e-05 -9.1121  &lt; 2e-16 ***
wks          8.3771e-04  5.8933e-04  1.4215  0.15518    
bluecolyes  -2.3848e-02  1.3477e-02 -1.7695  0.07680 .  
ind          1.5450e-02  1.5006e-02  1.0296  0.30320    
southyes     4.1898e-03  3.1740e-02  0.1320  0.89498    
smsayes     -4.6397e-02  1.8697e-02 -2.4815  0.01308 *  
marriedyes  -3.7679e-02  1.8567e-02 -2.0294  0.04242 *  
sexfemale   -1.6102e-01  1.3613e-01 -1.1829  0.23686    
unionyes     3.6777e-02  1.4522e-02  2.5325  0.01132 *  
ed           1.3847e-01  1.5234e-02  9.0895  &lt; 2e-16 ***
blackyes    -2.6570e-01  1.6615e-01 -1.5991  0.10979    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Total Sum of Squares:    242.65
Residual Sum of Squares: 92.859
R-Squared:      0.61731
Adj. R-Squared: 0.6162
Chisq: 6697.38 on 12 DF, p-value: &lt; 2.22e-16</code></pre>
</div>
</div>
<p>In the random effects model a single and constant term for the unobserved randomness is computed, so we have an intercept in here and can integrate time invariant variables like sex and if a person is black or not.</p>
<p>Alternatively to the function <code>plm</code> we can use also the <code>lm()</code>, the results differs slightly from each other:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a multilinear mixed model </span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>random_ml <span class="ot">&lt;-</span> <span class="fu">lmer</span>(lwage <span class="sc">~</span> exp <span class="sc">+</span> expSq <span class="sc">+</span> wks <span class="sc">+</span> bluecol <span class="sc">+</span> ind <span class="sc">+</span> south <span class="sc">+</span> smsa <span class="sc">+</span> married <span class="sc">+</span> sex <span class="sc">+</span> union <span class="sc">+</span> ed <span class="sc">+</span> black<span class="sc">+</span>(<span class="dv">1</span><span class="sc">|</span>id),<span class="at">data =</span> DAT)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(random_ml)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: lwage ~ exp + expSq + wks + bluecol + ind + south + smsa + married +  
    sex + union + ed + black + (1 | id)
   Data: DAT

REML criterion at convergence: -519.5

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-11.9385  -0.3404   0.0412   0.4086  12.6948 

Random effects:
 Groups   Name        Variance Std.Dev.
 id       (Intercept) 0.71114  0.8433  
 Residual             0.02357  0.1535  
Number of obs: 4165, groups:  id, 595

Fixed effects:
              Estimate Std. Error         df t value Pr(&gt;|t|)    
(Intercept)  3.124e+00  1.773e-01  5.962e+02  17.621  &lt; 2e-16 ***
exp          1.072e-01  2.456e-03  3.662e+03  43.669  &lt; 2e-16 ***
expSq       -5.140e-04  5.425e-05  3.666e+03  -9.476  &lt; 2e-16 ***
wks          8.400e-04  6.046e-04  3.436e+03   1.389  0.16477    
bluecolyes  -2.509e-02  1.379e-02  3.562e+03  -1.820  0.06887 .  
ind          1.383e-02  1.530e-02  3.712e+03   0.903  0.36633    
southyes     5.748e-03  3.164e-02  4.129e+03   0.182  0.85585    
smsayes     -4.746e-02  1.898e-02  3.889e+03  -2.501  0.01244 *  
marriedyes  -4.131e-02  1.900e-02  3.556e+03  -2.174  0.02973 *  
sexfemale   -1.753e-01  1.136e-01  4.870e+02  -1.544  0.12321    
unionyes     3.869e-02  1.482e-02  3.672e+03   2.610  0.00908 ** 
ed           1.357e-01  1.272e-02  4.911e+02  10.668  &lt; 2e-16 ***
blackyes    -2.613e-01  1.381e-01  4.654e+02  -1.892  0.05908 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Correlation matrix not shown by default, as p = 13 &gt; 12.
Use print(x, correlation=TRUE)  or
    vcov(x)        if you need it</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Estimate a random effects model using an ordinary least squares approach.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>random_ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage <span class="sc">~</span> exp <span class="sc">+</span> expSq <span class="sc">+</span> wks <span class="sc">+</span> bluecol <span class="sc">+</span> ind <span class="sc">+</span> south <span class="sc">+</span> smsa <span class="sc">+</span> married <span class="sc">+</span> sex <span class="sc">+</span> union <span class="sc">+</span> ed <span class="sc">+</span> black, </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> DAT)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(random_ols, <span class="at">vcov=</span><span class="fu">vcovHC</span>(random_ols, <span class="at">method=</span><span class="st">"arellano"</span>, <span class="at">cluster=</span><span class="st">"id"</span>)) <span class="do">## get panel robust std. errors</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lwage ~ exp + expSq + wks + bluecol + ind + south + 
    smsa + married + sex + union + ed + black, data = DAT)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.18965 -0.23536 -0.00988  0.22906  2.08738 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  5.251e+00  7.129e-02  73.662  &lt; 2e-16 ***
exp          4.010e-02  2.159e-03  18.574  &lt; 2e-16 ***
expSq       -6.734e-04  4.744e-05 -14.193  &lt; 2e-16 ***
wks          4.216e-03  1.081e-03   3.899 9.82e-05 ***
bluecolyes  -1.400e-01  1.466e-02  -9.553  &lt; 2e-16 ***
ind          4.679e-02  1.179e-02   3.967 7.39e-05 ***
southyes    -5.564e-02  1.253e-02  -4.441 9.17e-06 ***
smsayes      1.517e-01  1.207e-02  12.567  &lt; 2e-16 ***
marriedyes   4.845e-02  2.057e-02   2.355   0.0185 *  
sexfemale   -3.678e-01  2.510e-02 -14.655  &lt; 2e-16 ***
unionyes     9.263e-02  1.280e-02   7.237 5.45e-13 ***
ed           5.670e-02  2.613e-03  21.702  &lt; 2e-16 ***
blackyes    -1.669e-01  2.204e-02  -7.574 4.45e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3494 on 4152 degrees of freedom
Multiple R-squared:  0.4286,    Adjusted R-squared:  0.427 
F-statistic: 259.5 on 12 and 4152 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>After the model creation, you can access the coefficents and standard errors with this code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(random_ols, <span class="fu">vcovHC</span>(random_ols, <span class="at">method =</span> <span class="st">"arellano"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

               Estimate  Std. Error  t value  Pr(&gt;|t|)    
(Intercept)  5.2511e+00  7.4794e-02  70.2078 &lt; 2.2e-16 ***
exp          4.0105e-02  2.1678e-03  18.5001 &lt; 2.2e-16 ***
expSq       -6.7338e-04  4.8142e-05 -13.9874 &lt; 2.2e-16 ***
wks          4.2161e-03  1.1506e-03   3.6643 0.0002511 ***
bluecolyes  -1.4001e-01  1.4991e-02  -9.3394 &lt; 2.2e-16 ***
ind          4.6789e-02  1.2033e-02   3.8884 0.0001025 ***
southyes    -5.5637e-02  1.2787e-02  -4.3509 1.388e-05 ***
smsayes      1.5167e-01  1.2118e-02  12.5157 &lt; 2.2e-16 ***
marriedyes   4.8449e-02  2.0605e-02   2.3513 0.0187560 *  
sexfemale   -3.6779e-01  2.3229e-02 -15.8332 &lt; 2.2e-16 ***
unionyes     9.2627e-02  1.2379e-02   7.4823 8.864e-14 ***
ed           5.6704e-02  2.7368e-03  20.7193 &lt; 2.2e-16 ***
blackyes    -1.6694e-01  2.0874e-02  -7.9973 1.635e-15 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>While the fixed effect model only account for within variance, the random effects model can do both:</p>
<ul>
<li>in the fixed effects model the coefficients indicate the change on the output <span class="math inline">\(y\)</span> when the predictor change one unit over time</li>
<li>Beta coefficients indicate the change in the output <span class="math inline">\(y\)</span> when the predictors change one unit over time and across entities (average effect) → it is the average effect across the entities</li>
</ul>
<p>The difference between the OLS model and the GLS model is, that the GLS model is way more efficient, because it yields to homoscedastic disturbance terms. The random OLS model (I don’t really get why it is a random OLS, because it seems to me the same model with exactly the same results you have asked in <span class="quarto-unresolved-ref">?sec-ex.pool</span> for) does not account for cross-sectional heteroskedasticity and assumes, that all entities are uncorrelated to each other, even the individuals itself. It doesn’t take individual specific effects into account.</p>
<p>Because the random effects model accounts for between and within variability the estimates show the effects across individuals over time. With the Lagrange Multiplier Test we can test for random effects: It test for individual or time effects for panel models. It tests, if the variance in the random effects is zero. The LM-statistic follows a chi-squared distribution with 1 df, because we are testing for one measure only (the variance of the random effects term). If the nullhypothesis is rejected, the Random Effects Model is appropriate. With the Lagrange Multiplier test the Random Effects Model is compared to a pooled OLS, where no individual specific variation is assumed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plmtest</span>(random, <span class="st">"individual"</span>, <span class="at">type=</span><span class="st">"bp"</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Lagrange Multiplier Test - (Breusch-Pagan)

data:  lwage ~ exp + expSq + wks + bluecol + ind + south + smsa + married +  ...
chisq = 3497, df = 1, p-value &lt; 2.2e-16
alternative hypothesis: significant effects</code></pre>
</div>
</div>
<p>Null hypothesis is clearly rejected, we should go with the Random Effects Model.</p>
</section>
<section id="testing-for-random-effects-hausmans-specification-test" class="level3" data-number="3.11.6">
<h3 data-number="3.11.6" class="anchored" data-anchor-id="testing-for-random-effects-hausmans-specification-test"><span class="header-section-number">3.11.6</span> Testing for Random Effects: Hausman’s Specification Test</h3>
<p>Random or fixed effects model: Which should be used?</p>
<p>From a purely practical standpoint, the dummy variable approach is costly in terms of degrees of freedom lost. On the other hand, the fixed effects approach has one considerable virtue: There is little justification for treating the individual effects as uncorrelated with the other regressors, as is assumed in the random effects model. The random effects treatment, therefore, may suffer from the inconsistency due to this correlation between the included variables and the random effect → be careful, we cannot back up the assumption random effect is build on!</p>
<p>The specification test devised by Hausman (1978) is used to test for orthogonality of the random effects and the regressors.</p>
<p>The test is based on the idea that under the hypothesis of <strong>no correlation (H0)</strong>:</p>
<ul>
<li>OLS (in the LSDV model) and GLS are consistent, but</li>
<li>pure OLS is inefficient. → makes too much effort in data!</li>
</ul>
<p>Whereas under the <strong>alternative (H1)</strong></p>
<ul>
<li>OLS (in the LSDV model) is consistent, but * GLS is not.</li>
</ul>
<p>→ random effects model is biased, if there is a correlation between unobserved and included variables, then: OLS and GLS differs. Under null hypothesis the two estimates (OLS in LSDV and GLS) should not differ systematically and the test can be based on the difference.</p>
<p>How much the <span class="math inline">\(\beta\)</span>s in both models differ from each other?</p>
<p>Therefore, under the null hypothesis, the two estimates (OLS in LSDV and GLS) should not differ systematically, and a test can be based on the difference.</p>
<p><strong>to test the difference</strong>: Test statistic (based on the <strong>Wald criterion</strong>):</p>
<p><span class="math inline">\(W = [b − \hatβ]′Ψ−1[b − \hatβ],\)</span></p>
<p>where <span class="math inline">\(b\)</span> is the LSDV estimator and <span class="math inline">\(\hatβ\)</span> is the GLS estimator of the slope parameters of the linear panel model. And <span class="math inline">\(Var [b] − Var [\hatβ] = Ψ.\)</span></p>
<p>For <span class="math inline">\(\hatΨ\)</span>, we use the estimated covariance matrices of the slope estimator in the LSDV model and the estimated covariance matrix in the random effects model, excluding the constant term. Thus, the Hausman test for the fixed and random effects regressions is based on the parts of the coefficient vectors and the asymptotic covariance matrices that correspond to the slopes in the models, that is, ignoring the constant term(s).</p>
<p>Under the null hypothesis, <span class="math inline">\(W\)</span> has a (limiting) chi-squared distribution with <span class="math inline">\(K − 1\)</span> degrees of freedom.</p>
</section>
<section id="improving-random-effects-model" class="level3" data-number="3.11.7">
<h3 data-number="3.11.7" class="anchored" data-anchor-id="improving-random-effects-model"><span class="header-section-number">3.11.7</span> Improving Random Effects Model</h3>
<p>Even with a test available, choosing between the fixed and random effects specification presents a bit of a dilemma.</p>
<p>Both specifications have unattractive shortcomings: * The fixed effects approach is robust to correlation between the omitted heterogeneity and the regressors, but it proliferates parameters and cannot accommodate time-invariant regressors. * The random effects model hinges on an unlikely assumption, that the omitted heterogeneity is uncorrelated with the regressors.</p>
<p>There are several modifications of the random effects model that (at least partly) overcome its deficit.</p>
<p>Concretely: The failure of the random effects model is that the mean independence assumption,</p>
<p><span class="math display">\[E[c_i | X_i ] = E[α + u_i | X_i ] = α\]</span></p>
<p>is likely untenable.</p>
</section>
<section id="mundlaks-approach" class="level3" data-number="3.11.8">
<h3 data-number="3.11.8" class="anchored" data-anchor-id="mundlaks-approach"><span class="header-section-number">3.11.8</span> Mundlak’s Approach</h3>
<p><img src="figures\2.Mundlak.png" class="img-fluid" width="700"> Mundlak’s approach is often used as a compromise between the fixed and the random effects model.</p>
<p>One side benefit: provides another convenient approach to Hausman test. With the given model specification, the difference between “fixed effects” and “random effects” model is the nonzero <span class="math inline">\(\gamma\)</span>.</p>
<p>As such, a statistical test of the null hypothesis that γ equals zero is an alternative approach to the Lagrange multiplier and the Hausman test → an accordant test is the Variable Addition Test * under the null hypothesis (<span class="math inline">\(\gamma = 0\)</span>) VAT has chi=suqared distribution with <span class="math inline">\(k\)</span> degrees of freedom (<span class="math inline">\(k\)</span> is the number of means <span class="math inline">\(\overline{x}'_i\)</span> considered)</p>
</section>
</section>
<section id="which-model-to-take" class="level2" data-number="3.12">
<h2 data-number="3.12" class="anchored" data-anchor-id="which-model-to-take"><span class="header-section-number">3.12</span> Which model to take?</h2>
<p><img src="figures\2.which.png" class="img-fluid" width="500"></p>
<section id="exercise-4" class="level3" data-number="3.12.1">
<h3 data-number="3.12.1" class="anchored" data-anchor-id="exercise-4"><span class="header-section-number">3.12.1</span> Exercise</h3>
<ol type="1">
<li>Test whether a fixed effects or a random effects model fits the data better.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#use phtest, this is the function for the Hausman test</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">phtest</span>(fixed_w, <span class="co"># fixed effects</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>       random) <span class="co"># random effects</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Hausman Test

data:  lwage ~ exp + expSq + wks + bluecol + ind + south + smsa + married +  ...
chisq = 302.46, df = 9, p-value &lt; 2.2e-16
alternative hypothesis: one model is inconsistent</code></pre>
</div>
</div>
<p>The Hausman test shows, that the fixed effects model, the LSDV model is consistent, while the random effects model is not. The null hypothesis can be rejected: We can’t prove, that there is no correlation between the unobserved individual-specific effects are uncorrelated with the regressors. In not proving this, the pivotal assumption of a random regression model is violated.</p>
<p>We should go with the fixed effects model.</p>
<ol start="2" type="1">
<li>Find out which panel model fits the data best by following the decision tree diagram given on the previous slide. Explain.</li>
</ol>
<p>The data is introduced to us as as a sample data drawn from the years 1976- 1982 from the “Non-Survey of Economy Opportunity”.Because panel data is often sampled as random observation from the population, it highly probable, that this condition is also true for this data set.</p>
<p>In the former steps, we have created a fixed (<code>fixed_w</code>) and random effects regression (<code>random</code>). The Hausman test in the prior exercise is a strong indicator to go with the fixed effect model. It indiciates differences in the coefficients between OLS and GLS.</p>
<ol start="3" type="1">
<li>Implement Mundlak’s approach. What do you find? Interpret.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for Mundlak's approach we include group means for the regressors of interests, in this case the experience and work hours</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>A1 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(DAT<span class="sc">$</span>exp, <span class="at">by=</span><span class="fu">list</span>(DAT<span class="sc">$</span>id), mean)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>A2 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(DAT<span class="sc">$</span>expSq, <span class="at">by=</span><span class="fu">list</span>(DAT<span class="sc">$</span>id), mean)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>A3 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(DAT<span class="sc">$</span>wks, <span class="at">by=</span><span class="fu">list</span>(DAT<span class="sc">$</span>id), mean)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">cbind</span>(A1, A2[,<span class="dv">2</span>], A3[,<span class="dv">2</span>])</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(M) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"exp_m"</span>, <span class="st">"expSq_m"</span>, <span class="st">"wks_m"</span>)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>DAT <span class="ot">&lt;-</span> <span class="fu">merge</span>(DAT, M, <span class="at">by=</span><span class="st">"id"</span>, <span class="at">all.x=</span><span class="cn">TRUE</span>)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>random_mun <span class="ot">&lt;-</span> <span class="fu">plm</span>(lwage <span class="sc">~</span> exp <span class="sc">+</span> expSq <span class="sc">+</span> wks <span class="sc">+</span> bluecol <span class="sc">+</span> ind <span class="sc">+</span> south <span class="sc">+</span> smsa <span class="sc">+</span> married <span class="sc">+</span> sex <span class="sc">+</span> union <span class="sc">+</span> ed <span class="sc">+</span> black <span class="sc">+</span> exp_m <span class="sc">+</span> expSq_m <span class="sc">+</span> wks_m, </span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> DAT, <span class="at">model =</span> <span class="st">"random"</span>, <span class="at">random.method =</span> <span class="st">"amemiya"</span>, <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"time"</span>), <span class="at">effect=</span><span class="st">"individual"</span>)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(random_mun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Oneway (individual) effect Random Effect Model 
   (Amemiya's transformation)

Call:
plm(formula = lwage ~ exp + expSq + wks + bluecol + ind + south + 
    smsa + married + sex + union + ed + black + exp_m + expSq_m + 
    wks_m, data = DAT, effect = "individual", model = "random", 
    random.method = "amemiya", index = c("id", "time"))

Balanced Panel: n = 595, T = 7, N = 4165

Effects:
                  var std.dev share
idiosyncratic 0.02304 0.15180 0.021
individual    1.06368 1.03135 0.979
theta: 0.9445

Residuals:
      Min.    1st Qu.     Median    3rd Qu.       Max. 
-1.8247265 -0.0535394  0.0041373  0.0620001  1.9479602 

Coefficients:
               Estimate  Std. Error z-value  Pr(&gt;|z|)    
(Intercept)  5.0475e+00  6.3666e-01  7.9281 2.225e-15 ***
exp          1.1322e-01  2.3045e-03 49.1295 &lt; 2.2e-16 ***
expSq       -4.1816e-04  5.0917e-05 -8.2126 &lt; 2.2e-16 ***
wks          8.3376e-04  5.5926e-04  1.4908  0.136010    
bluecolyes  -2.3786e-02  1.2775e-02 -1.8619  0.062612 .  
ind          1.9860e-02  1.4226e-02  1.3960  0.162721    
southyes    -1.4556e-02  3.0102e-02 -0.4835  0.628709    
smsayes     -3.2588e-02  1.7736e-02 -1.8374  0.066152 .  
marriedyes  -2.9272e-02  1.7604e-02 -1.6628  0.096360 .  
sexfemale   -4.1521e-01  1.3072e-01 -3.1763  0.001491 ** 
unionyes     3.4746e-02  1.3781e-02  2.5213  0.011694 *  
ed           7.1661e-02  1.4774e-02  4.8504 1.232e-06 ***
blackyes    -1.4222e-01  1.5764e-01 -0.9022  0.366961    
exp_m       -7.7882e-02  1.7098e-02 -4.5549 5.240e-06 ***
expSq_m     -1.7464e-04  3.7699e-04 -0.4632  0.643188    
wks_m        7.9190e-03  1.2226e-02  0.6477  0.517157    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Total Sum of Squares:    242.65
Residual Sum of Squares: 83.374
R-Squared:      0.65639
Adj. R-Squared: 0.65515
Chisq: 7925.89 on 15 DF, p-value: &lt; 2.22e-16</code></pre>
</div>
</div>
<p>Improving the random effects model (<code>random</code>) with Mundlak’s approach and including the group means We can see that R-squared has incread from 0.61 in the random to 0.65 in the random_mun.</p>
<p>The effects in the individual and theta stay the same.</p>
<p>Also, there are substantial differences in the coefficients:</p>
<ul>
<li>The intercept in the random_mun is quite higher. * Exp and ExpSq is significant and positive in both models, but while exp is higher in random_mun, expSq is lower in random _mun compared to the random model.This can be explained the significant positive effect of the group mean of experience. * Including the group mean of Exp time invariant variables like sothyes, unionyes or blackyes, marriedyes, sexfemale and ed differs a lot!</li>
</ul>
<p>→ not treating the random effect and regressors as uncorrelated but conditional connected by the group mean of especially exp make huge differences in the strength of effects.</p>
<ol start="4" type="1">
<li>Conduct the Hausman test also with the Mundlak model. What do you find?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">phtest</span>(fixed_w, random_mun) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Hausman Test

data:  lwage ~ exp + expSq + wks + bluecol + ind + south + smsa + married +  ...
chisq = 2.1255, df = 9, p-value = 0.9893
alternative hypothesis: one model is inconsistent</code></pre>
</div>
</div>
<p>Comparing the former fixed effects model to the random effects model with Mundlak’s approach, the Hausman test is very different to the results in Exercise 1. Here we have a strong indicator, that there is no correlation between the random effect and the regressors, because including the group means for experience in years holds account for possible conditional relationships between the unobserved and the variables included.</p>
<p>In this case, we should go with the random effects model with Mundlak’s approach.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co">#fitting an OLS regression with means included </span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>random_mun_ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage <span class="sc">~</span> exp <span class="sc">+</span> expSq <span class="sc">+</span> wks <span class="sc">+</span> bluecol <span class="sc">+</span> ind <span class="sc">+</span> south <span class="sc">+</span> smsa <span class="sc">+</span> married <span class="sc">+</span> sex <span class="sc">+</span> union <span class="sc">+</span> ed <span class="sc">+</span> black <span class="sc">+</span> exp_m <span class="sc">+</span> expSq_m <span class="sc">+</span> wks_m, </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> DAT)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(random_mun_ols, <span class="at">vcov=</span><span class="fu">vcovHC</span>(random_mun_ols, <span class="at">method=</span><span class="st">"arellano"</span>, <span class="at">cluster=</span><span class="st">"id"</span>)) <span class="co">#get the pabel robust std. errors</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lwage ~ exp + expSq + wks + bluecol + ind + south + 
    smsa + married + sex + union + ed + black + exp_m + expSq_m + 
    wks_m, data = DAT)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.05493 -0.19779  0.00387  0.19910  2.00608 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  5.1123391  0.0856609  59.681  &lt; 2e-16 ***
exp          0.1130584  0.0049326  22.921  &lt; 2e-16 ***
expSq       -0.0004065  0.0001091  -3.726 0.000197 ***
wks          0.0008848  0.0011978   0.739 0.460111    
bluecolyes  -0.1372689  0.0127533 -10.763  &lt; 2e-16 ***
ind          0.0512831  0.0102737   4.992 6.23e-07 ***
southyes    -0.0606274  0.0108997  -5.562 2.83e-08 ***
smsayes      0.1619797  0.0105342  15.377  &lt; 2e-16 ***
marriedyes   0.0789305  0.0179278   4.403 1.10e-05 ***
sexfemale   -0.3452255  0.0219195 -15.750  &lt; 2e-16 ***
unionyes     0.0965354  0.0114552   8.427  &lt; 2e-16 ***
ed           0.0544956  0.0022799  23.903  &lt; 2e-16 ***
blackyes    -0.1594888  0.0191794  -8.316  &lt; 2e-16 ***
exp_m       -0.0803979  0.0053347 -15.071  &lt; 2e-16 ***
expSq_m     -0.0001695  0.0001179  -1.438 0.150481    
wks_m        0.0081826  0.0019437   4.210 2.61e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3039 on 4149 degrees of freedom
Multiple R-squared:  0.5678,    Adjusted R-squared:  0.5663 
F-statistic: 363.4 on 15 and 4149 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>With this model, we get the panel robust standard errors from a linear multi level model, fittd by REMl. Instead of using one single and constant term for the unobserved randomness like in the random effects model, we group the models by id. Linear multi level models account for period heteroskedasticity and time variation and therefore appropriate to investigate within variation. In the linear multi level model nearly all variables are significant. Though, the estimates are very similar to the random effects using Mundlak’s.</p>
<p>It is important to choose a model accordingly to our research interest, because not all models can explain the same things!</p>
<p>Open question, because I am not really confident in the former answer: I don’t understand, why the random_mun_ols is included in addition to the random effects model with Mundlak’s approach. Is the lm model an analysis of within variation and the random effects is an analysis for within and between variation? How have you interpreted the results of the different models ? And I don’t see the random effect in the random_mun_ols code, for me its a simple linear regression including the means for the variables, we are interested in. Or does we use the random_mun_ols only to get panel robust std. errors for our random_mun model?</p>
<p>In the next step, we can test with the Lagrange Multipliert test for individual and/ or effects of the panel model. The test compares the random effects model including the Mundlak’s approach to a pooled regression, where no individual speicfic variation is assumed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plmtest</span>(random_mun, <span class="st">"individual"</span>, <span class="at">type=</span><span class="st">"bp"</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Lagrange Multiplier Test - (Breusch-Pagan)

data:  lwage ~ exp + expSq + wks + bluecol + ind + south + smsa + married +  ...
chisq = 6707.2, df = 1, p-value &lt; 2.2e-16
alternative hypothesis: significant effects</code></pre>
</div>
</div>
<p>Null hypothesis is clearly rejected, we should go with the Random Effects Model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plmtest</span>(random, <span class="st">"individual"</span>, <span class="at">type=</span><span class="st">"bp"</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Lagrange Multiplier Test - (Breusch-Pagan)

data:  lwage ~ exp + expSq + wks + bluecol + ind + south + smsa + married +  ...
chisq = 3497, df = 1, p-value &lt; 2.2e-16
alternative hypothesis: significant effects</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./multi-level.html" class="pagination-link" aria-label="Multilevel Data Modelling">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Multilevel Data Modelling</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./missing-data.html" class="pagination-link" aria-label="Missing data and Statistical Modelling">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Missing data and Statistical Modelling</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>